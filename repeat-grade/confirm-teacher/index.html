<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบสมัครเรียน</title>
    <link rel="stylesheet" href="../../css/register.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
</head>
<body class="p-5 w-100" style="min-height: 100vh; background: linear-gradient(125deg, #f1c40f, #d35400);">

    <div class="d-flex flex-column align-items-center container ">
        <div id="headerenroll" class="text-center">
            <img src="../../imgs/logomain.png" style="width: 90px; object-fit: contain;">
            <br><br>
            <h4 class="text-white">ระบบลงทะเบียนจัดการสอบแก้ตัว</h4>
            <h4 class="text-white">โรงเรียนอุทัยวิทยาคม</h4>
        </div>
        <br>
        <div class="row w-100">
            <div class="card p-0">
                <h5 class="card-header mt-1 mb-1">ยืนยันตัวตน </h5>
                <div class="card-body">
                    <div class="row">
                        
                        <div class="col-12 col-sm-6 mb-3">
                            <p class="mb-0">คำนำหน้าชื่อ <span class="text-danger">*</span></p>
                            <select id="txt_title" disabled class="form-control">
                                <option value="">--- เลือก ---</option>
                                <option value="นาย">นาย</option>
                                <option value="นางสาว">นางสาว</option>
                                <option value="นาง">นาง</option>
                            </select>
                        </div>
                        <div class="col-12 col-sm-6 mb-3">
                            <!-- <p class="mb-0">เลขประจำตัวนักเรียน <span class="text-danger">*</span></p>
                            <input type="number" disabled placeholder="กรอกข้อความ" id="txt_userno" class="form-control"> -->
                        </div>
                        <div class="col-12 col-sm-6 mb-3">
                            <p class="mb-0">ชื่อ <span class="text-danger">*</span></p>
                            <input type="text" placeholder="กรอกข้อความ" id="txt_fname" disabled class="form-control">
                        </div>
                        <div class="col-12 col-sm-6 mb-3">
                            <p class="mb-0">นามสกุล <span class="text-danger">*</span></p>
                            <input type="text" placeholder="กรอกข้อความ" id="txt_lname" disabled class="form-control">
                        </div>
                        <div class="col-12 col-sm-6 mb-3">
                            <p class="mb-0">อีเมล <span class="text-danger">*</span></p>
                            <input type="text" placeholder="กรอกข้อความ" id="txt_email" disabled class="form-control">
                        </div>
                        <div class="col-12 col-sm-3 mb-3">
                            <p class="mb-0">ครูที่ปรึกษาประจำชั้น <span class="text-danger">*</span></p>
                            <select id="txt_level"  class="clearfil form-control">
                                <option value="">--- เลือก ---</option>
                                <option value="1">ม.1</option>
                                <option value="2">ม.2</option>
                                <option value="3">ม.3</option>
                                <option value="4">ม.4</option>
                                <option value="5">ม.5</option>
                                <option value="6">ม.6</option>
                            </select>
                        </div>
                        <div class="col-12 col-sm-3 mb-3">
                            <p class="mb-0">ครูที่ปรึกษาประจำห้อง <span class="text-danger">*</span></p>
                            <select id="txt_room"  class="clearfil form-control">
                                <option value="">--- เลือก ---</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                            </select>
                        </div>
                        <span class="mt-3 mb-3 text-danger text-center"><b>*** ตรวจสอบข้อมูลเบื้องต้น หากไม่ใช่ข้อมูลตนเอง กรุณาแจ้งผู้ดูแลระบบ</b></span>
                        <div class="d-flex justify-content-center">
                            <a onclick="studentConfirm()" class=" btn btn-success ms-1 me-1">ต่อไป<br>(นี่คือข้อมูลฉันเอง)</a>
                            <a href="../logout.html" class=" btn btn-danger ms-1 me-1">ออกจากระบบ<br>(ไม่ใช่ข้อมูลของฉัน)</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../global.js"></script>
    <script>
        // $.ajax({
        //     method: 'post',
        //     url: endpoint + '/utw-cors-api/check-login-student.php',
        //     data: {
        //         _method: "GET",
        //         email: "s26631@utw.ac.th",
        //     }, error: err => {
        //         err.responseText = JSON.parse(err.responseText)
        //         console.log(err.responseText)
        //         if(err.responseText.status.code == 400) {
        //             localStorage.setItem('utw_sidebar','sidebar1')
        //             window.location.href = `.../dashboard/courseregister.html`
        //         }
        //     }
        // })

        function studentConfirm() {
            $('.errmsg').remove()
            $('.clearfil').removeClass('is-invalid')
            if($('#txt_level').val() == '') {
                $('#txt_level').after(`<span class="errmsg text-danger">โปรดเลือกชั้นเรียน</span>`).addClass('is-invalid')
            }
            else if($('#txt_room').val() == '') {
                $('#txt_room').after(`<span class="errmsg text-danger">โปรดเลือกห้องเรียน</span>`).addClass('is-invalid')
            }
            else {
                $.ajax({
                    method: 'post',
                    url: endpoint + '/utw-cors-api/student-update-register.php',
                    data:{   
                        id: parseInt(localStorage.utwUserId),
                        email: localStorage.utwEmail,
                        class: parseInt($('#txt_level').val()),
                        room: parseInt($('#txt_room').val()),
                        mail_token: localStorage.utwAccessToken
                    }, success: response => {
                        if(response.status.code == 200) {
                            localStorage.setItem('utw_sidebar','sidebar1')
                            localStorage.setItem('utwToken',response.data.access_token)
                            window.location.href = `../dashboard/courseregister.html`
                        }
                    } ,
                    error: err => {
                       console.log('bad', err)
                    }
                })
                
            }
            
        }
        $('#txt_userno').val(localStorage.utwUserno)
        $('#txt_title').val(localStorage.utwtname)
        $('#txt_fname').val(localStorage.utwfname)
        $('#txt_lname').val(localStorage.utwlname)
        $('#txt_email').val(localStorage.utwEmail)
        // var m = String(localStorage.utwClassRoom).split('/')
        // var m1 = m[0]
        // var m2 = m[1]
        // $('#txt_level').val(m1)
        // $('#txt_room').val(m2)


    </script>
</body>
</html>