<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;800&display=swap');

        * {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            font-family: 'Sarabun', sans-serif;
            font-weight: 300;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #FAFAFA;
            font: 12pt "Tahoma";
        }

        .page-break {
            /* page-break-after: always !important; */
            page-break-before: auto;

        }

        .page {
            width: 29.7cm;
            min-height: 21cm;
            padding: 1cm;
            margin: auto;
            /* border: 1px #D3D3D3 solid; */
            border-radius: 5px;
            /* background: white; */
            /* box-shadow: 0 0 5px rgba(0, 0, 0, 0.1); */
        }

        .subpage {
            padding: 1cm;
            /* border: 5px red solid; */
            height: 210mm;
            /* outline: 1cm #FFEAEA solid; */
        }

        @page {
            size: landscape;
            /* size: A4; */
            margin: 0;
            margin-top: 50px;
            margin-bottom: 50px;
            width: 297mm;
            height: 210mm;
        }

        @media print {

            html,
            body {
                width: 297mm;
                height: 210mm;
            }

        }

        .table-breaked {
            page-break-before: auto;
        }

        div,
        span {
            font-size: 16px;
        }

        table th,
        table td {
            border: 1px solid #000;
            font-size: 12px;
            font-size: .5rem !important;
        }

        table td {
            padding: 0 5px;
        }

        @supports (writing-mode: vertical-lr) {
            .subhead span {
                display: inline-block;
                writing-mode: vertical-lr;
                white-space: nowrap;
                transform: rotate(180deg);
                line-height: 0;
                font-size: .5rem;
                margin-left: 5px;
                margin-top: 7px;
            }
        }

        table {}
    </style>
</head>

<body>
    <div class="book">
        <div class="page">
            <section class="subpage"
                style="position: relative; display: flex; flex-direction: column; align-items: center;">
                <div style="position: absolute; top: 10px; right: 38px; border: 1px solid #000;" class="px-4 py-2">
                    วผ.12/3</div>
                <div class="flex flex-col items-end px-4 py-2"
                    style="position: absolute; top: 60px; right: 38px; border: 1px solid #000;">
                    <div class="flex">
                        <div>ครั้งที่</div>
                        <span id="countja" class="border-dotted border-b-2 border-slate-900 px-4"></span>
                    </div>
                    <div class="flex mt-2">
                        <div>ภาคเรียนที่</div>
                        <span id="numyearja" class="border-dotted border-b-2 border-slate-900 px-4"></span>
                        <div>/</div>
                        <span id="yearterm" class="border-dotted border-b-2 border-slate-900 px-4"></span>
                    </div>
                </div>
                <h4 style="font-size: 20px; " class="font-bold">โรงเรียนอุทัยวิทยาคม จังหวัดอุทัยธานี</h4>
                <h4 style="font-size: 20px; " class="font-bold">แบบรายงานลงทะเบียนเรียนซ้ำ</h4>
                <div class="flex  mt-2">
                    <div>รายวิชา</div>
                    <span id="raivicha" class="border-dotted border-b-2 border-slate-900 px-4 w-64 text-center"></span>
                    <div>หน่วยกิต</div>
                    <span id="nuikiy" class="border-dotted border-b-2 border-slate-900 px-4 w-5 text-center">-</span>
                </div>
                <br>

                <h6 style="font-size: 14px;" class="font-bold">อัตราส่วนคะแนนระหว่างภาค : ปลายภาค
                    <span style="font-size: 14px;" class="font-bold">75</span> :
                    <span style="font-size: 14px;" class="font-bold">25</span>
                    ตัวชี้วัด / ผลการเรียนรู้ ก่อนวัดผลกลางภาค : วัดผลกลางภาคเรียน : หลังวัดผลกลางภาค =
                    <span style="font-size: 14px;" class="font-bold">25</span> :
                    <span style="font-size: 14px;" class="font-bold">25</span> :
                    <span style="font-size: 14px;" class="font-bold">25</span>
                </h6>


                <div class="table-breaked" style="width: 100%;">
                    <table class="w-full" style="width: 100%; font-size: 14px;">
                        <thead id="thead">


                        </thead>
                        <tbody id="tbody">


                        </tbody>
                    </table>
                </div>

                <br>
                <div class="w-full breaked-after">
                    <div class="w-16"></div>
                    <div class="w-full flex justify-content-between">
                        <div class="flex flex-col items-center">
                            <div>รับรองข้อมูล</div>
                            <br><br>
                            <div class="flex">
                                <span class="border-dotted border-b-2 border-slate-900 px-8 w-64"></span>
                            </div>
                            <div class="flex mt-2">
                                <div>(</div>
                                <span id="myteacher" class="border-dotted border-b-2 border-slate-900 px-8 "></span>
                                <div>)</div>
                            </div>
                            <div>ครูประจำวิชา</div>
                            <span class="datenow border-dotted border-b-2 border-slate-900 px-8 "></span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div>รับรองข้อมูล</div>
                            <br><br>
                            <div class="flex">
                                <span class="border-dotted border-b-2 border-slate-900 px-8 w-64"></span>
                            </div>
                            <div class="flex mt-2">
                                <div>(</div>
                                <span class="border-dotted border-b-2 border-slate-900 px-8 ">นางสมสุข โชติพิเชฐ</span>
                                <div>)</div>
                            </div>
                            <div>นายทะเบียน</div>
                            <!-- <span class="datenow border-dotted border-b-2 border-slate-900 px-8 "></span> -->
                        </div>
                        <div class="flex flex-col items-center">
                            <div>ดำเนินการแก้ไขเรียบร้อยแล้ว</div>
                            <br><br>
                            <div class="flex">
                                <span class="border-dotted border-b-2 border-slate-900 px-8 w-64"></span>
                            </div>
                            <div class="flex mt-2">
                                <div>(</div>
                                <span class="border-dotted border-b-2 border-slate-900 px-8 ">นางสาวสุภาวดี
                                    กระแสสินธุ์</span>
                                <div>)</div>
                            </div>
                            <div>งาน GPA</div>
                            <!-- <span class="datenow border-dotted border-b-2 border-slate-900 px-8 "></span> -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script src="../global.js?v06"></script>
    <script>
        const urlx = new URL(window.location.href);
        const idx = urlx.searchParams.get("id");
        const sbj = urlx.searchParams.get("sbj");
        const sbjc = urlx.searchParams.get("sbjc");
        const sbjcl = urlx.searchParams.get("sbjcl");
        const user_id = urlx.searchParams.get("user_id");
        const Pterm = urlx.searchParams.get("term");
        const Pyear = urlx.searchParams.get("year");
        const Pround = urlx.searchParams.get("round");

        $(document).ready(() => {
            render()
            $('#myteacher').text(localStorage.utwFullname)
            $('.datenow').text(dateengtodatethai(getDateNow().split(" ")[0]))
        })

        function groupDatesByMonth(dates) {
            const monthNamesTH = [
                "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน",
                "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
            ];

            // เรียงวันที่จากน้อยไปมาก
            dates.sort((a, b) => new Date(a) - new Date(b));

            const grouped = {};

            dates.forEach(dateStr => {
                const date = new Date(dateStr);
                const month = monthNamesTH[date.getMonth()];
                if (!grouped[month]) {
                    grouped[month] = [];
                }
                grouped[month].push(dateStr);
            });

            return grouped;
        }
        function getDateNow() {
            var d = new Date();
            var dy = d.getFullYear();
            var dm = (d.getMonth() + 1) < 10 ? '0' + (d.getMonth() + 1) : (d.getMonth() + 1);
            var dd = d.getDate() < 10 ? '0' + d.getDate() : d.getDate();

            var th = d.getHours() < 10 ? '0' + d.getHours() : d.getHours();
            var tm = d.getMinutes() < 10 ? '0' + d.getMinutes() : d.getMinutes();
            var ts = d.getSeconds() < 10 ? '0' + d.getSeconds() : d.getSeconds();
            return `${dy}-${dm}-${dd} ${th}:${tm}:${ts}`;
        }
        function dateengtodatethai(date) {
            if (date) {
                var d = String(date).split('-')
                date = `${d[2]}/${d[1]}/${parseInt(d[0]) + 543}`
                return date;
            }
            else {
                return 'invalid format'
            }
        }
        function dateentoth(date) {
            var d = String(date).split('-')
            var dd = d[2];
            var dm = d[1];
            var dy = parseInt(d[0]) + 543;
            return `${dd}/${dm}/${dy}`;
        }
        function getDateMil(mil) {
            var d = new Date(mil)
            var dy = d.getFullYear();
            var dm = (d.getMonth() + 1) < 10 ? '0' + (d.getMonth() + 1) : (d.getMonth() + 1);
            var dd = d.getDate() < 10 ? '0' + d.getDate() : d.getDate();

            var th = d.getHours() < 10 ? '0' + d.getHours() : d.getHours();
            var tm = d.getMinutes() < 10 ? '0' + d.getMinutes() : d.getMinutes();
            var ts = d.getSeconds() < 10 ? '0' + d.getSeconds() : d.getSeconds();
            return `${dy}-${dm}-${dd} ${th}:${tm}:${ts}`;
        }
        Date.prototype.addDays = function (days) {
            this.setDate(this.getDate() + parseInt(days));
            return this;
        };
        var nuikit = "";
        function render() {
            loading(true)
            $.ajax({
                method: 'post',
                url: endpointv2 + '/utw-modify-api/course-getone',
                data: {
                    _method: "GET",
                    key_address: 'repeat_date'
                }, success: response => {
                    console.log('good', response)
                    if (response.status.code == 200) {
                        $('#countja').text(response.data.in_data.date_section)
                        $('#numyearja').text(response.data.in_data.date_term)
                        $('#yearterm').text(response.data.in_data.date_year_education)
                    }
                    else {
                        errswal()
                    }
                }, error: err => {
                    errswal()
                    console.log('bad', err)
                }
            })

            $.ajax({
                method: 'POST',
                url: endpointv2 + `/utw-modify-api/report/course-follow-success`,
                headers: {
                    "Authorization": "Bearer 36FFDS5214FSAFASddaF894a0e4a801fc38251f1f40f8c3b8f5bed1667dae64de0dasd"
                }, data: {
                    subject_id: idx,
                    teacher_id: user_id,
                    term: Pterm,
                    year: Pyear,
                    round: Pround
                }, success: response => {
                    console.log(response)
                    // response.data = [
                    //     {
                    //         "id": 5,
                    //         "student_id": 623,
                    //         "student": {
                    //             "id": "623",
                    //             "part": "-",
                    //             "room": "6",
                    //             "class": "3",
                    //             "fname": "นันทัชพร",
                    //             "lname": "บวรสิริยานนท์",
                    //             "tname": "ด.ญ."
                    //         },
                    //         "student_activity": [
                    //             {
                    //                 "indicator": "นักเรียนต้องเรียนอย่างน้อย 32/40 ชั่วโมง",
                    //                 "successDate": "2025-05-03T16:28:57.441Z"
                    //             },
                    //             {
                    //                 "indicator": "ok",
                    //                 "successDate": "2025-05-03T16:28:57.441Z"
                    //             },
                    //             {
                    //                 "indicator": "dog",
                    //                 "successDate": "2025-05-03T16:28:57.441Z"
                    //             },
                    //             {
                    //                 "indicator": "cat",
                    //                 "successDate": "2025-05-03T16:29:07.468Z"
                    //             }
                    //         ],
                    //         "learn_amount": null,
                    //         "learn_total": null,
                    //         "status": "success",
                    //         "department_id": 4,
                    //         "subject_id": 251,
                    //         "subject_title": "ภูมิศาสตร์",
                    //         "subject_code": "ส23103",
                    //         "subject_class": 3,
                    //         "teacher_id": 2226,
                    //         "teacher": {
                    //             "id": 2226,
                    //             "part": "-",
                    //             "room": 10,
                    //             "class": 3,
                    //             "fname": "สุภาวดี",
                    //             "lname": "กระแสสินธุ์",
                    //             "tname": "นางสาว"
                    //         },
                    //         "grade_old": "0",
                    //         "grade_new": "1",
                    //         "confirm_date": "2025-05-03T20:26:41.000Z",
                    //         "round_at": 3,
                    //         "term_at": 2,
                    //         "year_at": 2566,
                    //         "created_at": "2025-05-03T20:26:40.000Z",
                    //         "updated_at": "2025-05-03T20:26:40.000Z",
                    //         "stamp_round_at": 3,
                    //         "stamp_term_at": 2,
                    //         "stamp_year_at": 2567,
                    //         "start_date": null,
                    //         "end_date": null,
                    //         "input_type": "system",
                    //         "time_learning": [
                    //             "2025-03-04",
                    //             "2025-03-05",
                    //             "2025-03-06",
                    //             "2025-03-07",
                    //             "2025-03-08",
                    //             "2025-03-10",
                    //             "2025-03-11",
                    //             "2025-03-12",
                    //             "2025-03-13",
                    //             "2025-03-14",
                    //             "2025-03-15",
                    //             "2025-03-17",
                    //             "2025-03-18",
                    //             "2025-03-19",
                    //             "2025-04-03",
                    //         ],
                    //         "before_mid_score": 12,
                    //         "mid_score": 22,
                    //         "before_final_score": 30,
                    //         "final_score": 20,
                    //         "sum_score": 84,
                    //         "ac_1": 1,
                    //         "ac_2": 1,
                    //         "ac_3": 1,
                    //         "ac_4": 1,
                    //         "ac_5": 1,
                    //         "ac_6": 1,
                    //         "ac_7": 1,
                    //         "ac_8": 1,
                    //         "ac_avg": 1,
                    //         "rtw_1": 1,
                    //         "rtw_2": 1,
                    //         "rtw_3": 1,
                    //         "rtw_4": 1,
                    //         "rtw_5": 1,
                    //         "rtw_avg": 1
                    //     },
                    //     {
                    //         "id": 5,
                    //         "student_id": 623,
                    //         "student": {
                    //             "id": "623",
                    //             "part": "-",
                    //             "room": "6",
                    //             "class": "3",
                    //             "fname": "นันทัชพร",
                    //             "lname": "บวรสิริยานนท์",
                    //             "tname": "ด.ญ."
                    //         },
                    //         "student_activity": [
                    //             {
                    //                 "indicator": "นักเรียนต้องเรียนอย่างน้อย 32/40 ชั่วโมง",
                    //                 "successDate": "2025-05-03T16:28:57.441Z"
                    //             },
                    //             {
                    //                 "indicator": "ok",
                    //                 "successDate": "2025-05-03T16:28:57.441Z"
                    //             },
                    //             {
                    //                 "indicator": "dog",
                    //                 "successDate": "2025-05-03T16:28:57.441Z"
                    //             },
                    //             {
                    //                 "indicator": "cat",
                    //                 "successDate": "2025-05-03T16:29:07.468Z"
                    //             }
                    //         ],
                    //         "learn_amount": null,
                    //         "learn_total": null,
                    //         "status": "success",
                    //         "department_id": 4,
                    //         "subject_id": 251,
                    //         "subject_title": "ภูมิศาสตร์",
                    //         "subject_code": "ส23103",
                    //         "subject_class": 3,
                    //         "teacher_id": 2226,
                    //         "teacher": {
                    //             "id": 2226,
                    //             "part": "-",
                    //             "room": 10,
                    //             "class": 3,
                    //             "fname": "สุภาวดี",
                    //             "lname": "กระแสสินธุ์",
                    //             "tname": "นางสาว"
                    //         },
                    //         "grade_old": "0",
                    //         "grade_new": "1",
                    //         "confirm_date": "2025-05-03T20:26:41.000Z",
                    //         "round_at": 3,
                    //         "term_at": 2,
                    //         "year_at": 2566,
                    //         "created_at": "2025-05-03T20:26:40.000Z",
                    //         "updated_at": "2025-05-03T20:26:40.000Z",
                    //         "stamp_round_at": 3,
                    //         "stamp_term_at": 2,
                    //         "stamp_year_at": 2567,
                    //         "start_date": null,
                    //         "end_date": null,
                    //         "input_type": "system",
                    //         "time_learning": [
                    //             "2025-03-04",
                    //             "2025-03-05",
                    //             "2025-03-06",
                    //             "2025-03-07",
                    //             "2025-03-08",
                    //             "2025-03-10",
                    //             "2025-03-11",
                    //             "2025-03-12",
                    //             "2025-03-13",
                    //             "2025-03-14",
                    //             "2025-03-15",
                    //             "2025-03-17",
                    //             "2025-03-18",
                    //             "2025-03-19",
                    //             "2025-04-02",
                    //             "2025-04-01",
                    //         ],
                    //         "before_mid_score": 12,
                    //         "mid_score": 22,
                    //         "before_final_score": 30,
                    //         "final_score": 20,
                    //         "sum_score": 84,
                    //         "ac_1": 1,
                    //         "ac_2": 1,
                    //         "ac_3": 1,
                    //         "ac_4": 1,
                    //         "ac_5": 1,
                    //         "ac_6": 1,
                    //         "ac_7": 1,
                    //         "ac_8": 1,
                    //         "ac_avg": 1,
                    //         "rtw_1": 1,
                    //         "rtw_2": 1,
                    //         "rtw_3": 1,
                    //         "rtw_4": 1,
                    //         "rtw_5": 1,
                    //         "rtw_avg": 1
                    //     }

                    // ]
                    console.log("###", response.data)
                    if (response.status.code == 200) {
                        var html = '';
                        $('#raivicha').text(sbjc + ' ' + sbj)

                        var alldate = [];
                        for (let i = 0; i < response.data.length; i++) {
                            const element = response.data[i];
                            if (element.time_learning && element.time_learning[0]) {
                                for (let x = 0; x < element.time_learning.length; x++) {
                                    const element2 = element.time_learning[x];
                                    if (alldate.includes(element2)) {
                                        // skip
                                    }
                                    else {
                                        alldate.push(element2)
                                    }
                                }
                            }
                        }
                        var cleanDate = alldate && alldate[0] ? groupDatesByMonth(alldate) : [];

                        var thead_tmonth = "";
                        var thead_tdate = "";
                        var thead_submonth = "";
                        var date_couter = 0;
                        var date_couter_all = 0;
                        var cleanDateV2 = [];

                        for (var key in cleanDate) {
                            date_couter = 0;
                            for (let x = 0; x < cleanDate[key].length; x++) {
                                const elementd = cleanDate[key][x];
                                date_couter++;
                                date_couter_all++;
                                cleanDateV2.push(elementd)
                                thead_tdate += `<th style="text-align: center; font-size: .5rem;">${String(elementd).split("-")[2]}</th>`;
                            }
                            thead_tmonth += `<th colspan="${date_couter}" style="font-size: .7rem; text-align: center;">${key}</th>`;
                        }

                        // if(thead_tdate == "") {
                        //     thead_tdate = `<th></th>`;
                        // }
                        // if(thead_tmonth == "") {
                        //     thead_tmonth = `<th></th>`;
                        // }


                        var thead =
                            `<tr class="subhead">
                                <th rowspan="4" style="font-size: .5rem; text-align: center; padding: 0 5px;">เลขที่</th>
                                <th rowspan="4" style="font-size: .5rem; text-align: center; padding: 0 5px;">ชื่อ - สกุล</th>
                                <th rowspan="4" style="font-size: .5rem; text-align: center; padding: 0 5px;">ชั้น</th>
                                <th rowspan="2" colspan="${date_couter_all}" colspan="30" style="font-size: .5rem; text-align: center; padding: 0 5px;">
                                    <div class="d-flex flex-column align-items-center">
                                        <div style="display: flex;">
                                            <div style="font-size: .5rem;">ครั้งที่</div>
                                            <div style="font-size: .5rem; margin: 0 5px;">1</div>
                                            <div style="font-size: .5rem;">ระยะเวลาตั้งแต่</div>
                                        </div>
                                        <div style="font-size: .5rem;">วันที่ ${cleanDateV2 && cleanDateV2[0] ? cleanDateV2[0] : "-"}</div>
                                        <div style="font-size: .5rem;">ถึง</div>
                                        <div style="font-size: .5rem;">วันที่ ${cleanDateV2 && cleanDateV2[0] ? cleanDateV2[cleanDateV2.length - 1] : "-"}</div>
                                    </div>
                                </th>
                                <th rowspan="4" style="font-size: .7rem; text-align: center; padding: 0 5px;">
                                    <span>ก่อนวัดผลกลางภาคเรียน</span></th>
                                <th rowspan="4" style="font-size: .7rem; text-align: center; padding: 0 5px;">
                                    <span>วัดผลกลางภาคเรียน</span></th>
                                <th rowspan="4" style="font-size: .7rem; text-align: center; padding: 0 5px;">
                                    <span>หลังวัดผลกลางภาคเรียน</span></th>
                                <th rowspan="4" style="font-size: .7rem; text-align: center; padding: 0 5px;">
                                    <span>วัดผลปลายภาคเรียน</span></th>
                                <th rowspan="4" style="font-size: .7rem; text-align: center; padding: 0 5px;">
                                    <span>คะแนนรวม</span></th>
                                <th rowspan="4" style="font-size: .7rem; text-align: center; padding: 0 5px;">
                                    <span>ผลการเรียน</span></th>
                                <th colspan="9" style="font-size: .7rem; text-align: center; padding: 0 5px;">คุณลักษณะอันพึงประสงค์
                                </th>
                                <th colspan="6" style="font-size: .7rem; text-align: center; padding: 0 5px;">การอ่าน,
                                    คิดวิเคราะห์,<br>เขียน</th>

                            </tr>
                            <tr class="subhead">
                                <th class="vertical-cell">
                                    <span class="">รักชาติ ศาสนา กษัตริย์</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">ซื่อสัตย์ สุจริต</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">มีวินัย</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">ใฝ่เรียนรู้</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">อยู่อย่างพอเพียง</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">มุ่งมั่นการทำงาน</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">รักความเป็นไทย</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">มีจิตสาธารณะ</span>
                                </th>
                                <th rowspan="3" class="vertical-cell">
                                    <span class="">สรุปผลการประเมิน</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">อ่าน</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">เขียน</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">สื่อความ</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">คิดวิเคราะห์</span>
                                </th>
                                <th class="vertical-cell">
                                    <span class="">สังเคราะห์</span>
                                </th>
                                <th rowspan="3" class="vertical-cell">
                                    <span class="">สรุปผลการประเมิน</span>
                                </th>
                            </tr>
                            <tr>
                                ${thead_tmonth}
                            </tr>
                            <tr>
                                ${thead_tdate}
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                                <th style="text-align: center;">3</th>
                            </tr>
                                
                                `
                        $("#thead").html(thead)


                        // response.data.forEach((datax,a) => {
                        var a = 0;
                        var html = "";
                        for (let i = 0; i < response.data.length; i++) {
                            const element = response.data[i];

                            var a = new Date(element.start_date).getTime();
                            var b = getDateMil(a).split(" ");
                            var c = dateentoth(b[0]);

                            var d = new Date(element.end_date).getTime();
                            var e = getDateMil(d).split(" ");
                            var f = dateentoth(e[0]);

                            var g = new Date(element.confirm_date).getTime();
                            var h = getDateMil(g).split(" ");
                            var k = dateentoth(h[0]);

                            var cleanDateByStudent = element.time_learning && element.time_learning[0] ? groupDatesByMonth(element.time_learning) : [];

                            var cleanDateV2ByStudent = [];

                            for (var key in cleanDateByStudent) {
                                for (let x = 0; x < cleanDateByStudent[key].length; x++) {
                                    const elementd = cleanDateByStudent[key][x];
                                    cleanDateV2ByStudent.push(elementd)
                                }
                            }



                            var tick = "";
                            console.log("cleanDateV2", cleanDateV2)
                            console.log("cleanDateV2ByStudent", cleanDateV2ByStudent)
                            for (let z = 0, c = 0; z < cleanDateV2.length; z++) {
                                const elementA = cleanDateV2[z];
                                const elementB = cleanDateV2ByStudent[c];
                                console.log("elementB", elementB)
                                if (elementA == elementB) {
                                    tick += `<td style="padding: 0; text-align: center;">/</td>`;
                                    c++;
                                }
                                else {
                                    tick += `<td style="padding: 0; text-align: center;"></td>`;
                                }
                            }

                            if(tick == "" ) {
                                tick += `<td style="padding: 0; text-align: center;"></td>`;
                            }

                            if (element.student_activity && element.student_activity[0]) {
                                haNuikit(element.student_activity[0]);
                            }

                            html += `
                            <tr>
                                <td style="padding: 0; text-align: center;">${element.student.id}</td>
                                <td style="padding: 0; ">${element.student.tname}${element.student.fname} ${element.student.lname}</td>
                                <td style="padding: 0; text-align: center;">${element.student.class}/${element.student.room}</td>
                                ${tick}
                                <td style="padding: 0; text-align: center;">${element.before_mid_score ? element.before_mid_score : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.mid_score ? element.mid_score : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.before_final_score ? element.before_final_score : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.final_score ? element.final_score : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.sum_score ? element.sum_score : ""}</td>
                                <td style="padding: 0; text-align: center;">1</td>
                                <td style="padding: 0; text-align: center;">${element.ac_1 ? element.ac_1 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.ac_2 ? element.ac_2 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.ac_3 ? element.ac_3 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.ac_4 ? element.ac_4 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.ac_5 ? element.ac_5 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.ac_6 ? element.ac_6 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.ac_7 ? element.ac_7 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.ac_8 ? element.ac_8 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.ac_avg ? element.ac_avg : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.rtw_1 ? element.rtw_1 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.rtw_2 ? element.rtw_2 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.rtw_3 ? element.rtw_3 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.rtw_4 ? element.rtw_4 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.rtw_5 ? element.rtw_5 : ""}</td>
                                <td style="padding: 0; text-align: center;">${element.rtw_avg ? element.rtw_avg : ""}</td>
                                
                            </tr>`;

                        }
                        $('#tbody').html(html)
                        loading(false)

                    }
                    else {
                        loading(false)
                    }
                }, error: err => {
                    loading(false)
                    console.log(err)
                }
            })
        }

        function haNuikit(data) {
            console.log("haNuikit",data.indicator)
            var a = String(data.indicator).split(" ");
            var b = String(a[1]).split("/")[1];
            nuikit = b;
            if(nuikit == "20") {
                nuikit = "0.5";
            }
            else if(nuikit == "40") {
                nuikit = "1";
            }
            else if(nuikit == "60") {
                nuikit = "1.5";
            }
            else if(nuikit == "80") {
                nuikit = "2";
            }
            else if(nuikit == "100") {
                nuikit = "2.5";
            }
            $("#nuikiy").text(nuikit ? nuikit : "-")
            return nuikit;
        }
    </script>
</body>

</html>